---
layout: post
title:  "허깅페이스 오디오 트랜스포머 코스 4일차"
date:   2025-11-23 00:10:22 +0900
categories: Huggingface_Audio
---

# 오디오 데이터 스트리밍하기


오디오 데이터셋은 보통 매우 크고 무겁다.
예를 들어, 압축되지 않은 1분짜리 CD 품질(44.1kHz, 16-bit) 오디오만 해도 약 5MB를 차지한다.
대부분의 음성 데이터셋은 수백~수천 시간 분량이므로 수십 GB를 가볍게 넘는다.

이전 글에서는 MINDS-14처럼 작은 데이터셋을 사용했지만, 실제 작업에서는 훨씬 큰 데이터셋을 다루게 된다.

예시:
- **GigaSpeech-xs**: 10시간 -> 다운로드 + 준비에 13GB 필요
- **GigaSpeech-xl**: 10,000시간 -> 약 1TB 필요

대부분의 로컬 환경에서는 이런 데이터셋을 통째로 다운로드하기 어렵다.

이 문제를 해결하기 위해 **Datasets는 "스트리밍 모드(streaming mode)"**를 제공한다.

## 스트리밍 모드의 개념

스트리밍 모드는 데이터셋 전체를 디스크에 저장하지 않고,
필요한 데이터만 즉석에서(online) 불러오는 방식이다.

### 데이터 처리 방식 사이

- 로컬 다운로드: 전체 다운로드 -> 전처리 -> 저장 -> 로딩
- 스트리밍 모드: 필요한 만큼만 즉시 다운로드 -> 즉시 처리

데이터셋을 순회(iterate)하는 순간에 다음 샘플을 가져오므로
임의의 크기의 데이터셋도 메모리와 디스크 용량에 제약받지 않고 사용할 수 있다.

## 스트리밍 모드를 사용해야 하는 이유

1. 디스크 공간 절약

데이터를 로컬에 저장하지 않는다.
필요한 샘플만 메모리에 잠시 로드하고 바로 폐기하므로 어떤 크기의 데이터셋도 처리 가능하다.

2. 즉시 처리 가능

전체 데이터를 다운로드할 필요가 없다.
데이터가 준비되는 즉시 모델 돌리기, 전처리 테스트 등을 시작할 수 있다.

3. 빠른 실험

작은 구간만 테스트해서 스크립트가 잘 작동하는지 빠르게 검증 가능하다.
대규모 데이터셋 개발에서 매우 유용하다.

## 스트리밍 모드의 단점

스트리밍 시에는 데이터가 디스크에 캐시되지 않는다.

단점은 다음과 같다.

- 원본 오디오 파일이 저장되지 않음
- 전처리된 결과도 저장되지 않음

따라서 어떤 데이터를 반복해서 사용할 계획이라면 스트리밍은 적합하지 않다.
매번 다시 다운로드하고 다시 처리해야 하기 때문이다.

### 데이터셋 접근 방식

- 자주 재사용할 데이터셋 -> 전체 다운로드
- 1회성 실험, 초대형 데이터셋 -> 스트리밍

이렇게 선택하는 것이 좋다.

## 스트리밍 활성화하기

사용법은 매우 간단하다.

```python
gigaspeech = load_dataset("speechcolab/gigaspeech", "xs", streaming=True)
```

이 한 줄이면 된다.

## 스트리밍 데이터셋 접근 방식

스트리밍 모드에서는 파이썬 인덱싱이 불가능하다.

즉, 아래는 사용할 수 없다.

```python
gigaspeech["train"][10]   # 불가능
```

대신 iter()로 순회해야 한다.

```python
next(iter(gigaspeech["train"]))
```

출력 예시

```python
{
    "segment_id": "...",
    "speaker": "N/A",
    "text": "AS THEY'RE LEAVING...",
    "audio": { ... },
    ...
}
```

## 여러 샘플 미리 보기: take()

대형 데이터셋의 앞부분을 여러 개 보고 싶으면 take()를 사용한다.

```python
gigaspeech_head = gigaspeech["train"].take(2)
list(gigaspeech_head)
```

take(n)은 앞에서부터 n개만 스트리밍해 반환한다.
데이터가 무한히 큰 경우에도 매우 유용하다.

## 스트리밍 + 전처리(map)도 가능

스트리밍 데이터셋도 map()을 그대로 사용할 수 있다.
다만, 모든 데이터가 저장되지 않고 즉석에서 처리 후 버려진다.

예시:
- 오디오 리샘플링
- Whisper feature extractor 적용
- 텍스트 정제
- 길이 필터링

이 모든 작업을 스트리밍 데이터에도 수행할 수 있다.

## 실무에서 스트리밍을 특히 사용해야 하는 경우

1. 수백 GB를 넘는 초대형 음성 데이터셋

예시: GigaSpeech, LibriLight, Common Voice 전체 합본

2. 여러 데이터셋을 동시에 평가할 때

여러 데이터셋을 모두 다운로드하려면 디스크가 매우 빠르게 꽉 찬다.
스트리밍이면 저장 공간 부담 없이 전부 테스트 가능하다.

3. ESB(End-to-End Speech Benchmark) 같은 광범위 벤치마크 평가

다양한 도메인의 오디오를 즉석에서 불러오며 평가 가능하다.

## 스트리밍이 특히 유리한 상황 정리


| 상황              | 스트리밍 추천 여부         |
| --------------- | ------------------ |
| 연구 초기 실험        | 매우 좋음              |
| 데이터셋이 10GB 이하   | 필요 없음(다운로드가 더 효율적) |
| 데이터셋이 100GB 이상  | 스트리밍 필수            |
| 여러 데이터셋을 동시에 평가 | 스트리밍 유리            |
| 데이터셋을 반복 사용     | 비추천(다운로드 추천)       |


## 마무리

스트리밍 모드는 오디오 데이터셋을 다루는 데 있어 매우 강력한 기능이다.

- 디스크 용량 걱정 없이 초대형 데이터셋 사용 가능
- 즉시 학습/전처리 테스트 가능
- 초대형 벤치마크 환경에서 필수

하지만 반복 사용이 필요한 경우에는 전체 다운로드가 더 효율적일 수 있다.

대규모 음성 모델(ASR, TTS, SED)을 다루는 사람이라면
스트리밍 모드를 이해하고 활용하는 것은 필수적인 기술이다.

참고자료
Huggingface, Audio Course, https://huggingface.co/learn