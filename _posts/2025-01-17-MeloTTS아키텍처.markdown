---
layout: post
title:  "MeloTTS – TTS를 위한 MeCab 환경설정 삽질 기록"
date:   2026-01-16 00:10:22 +0900
categories: Style-Bert-VITS2
---

# TTS를 위한 MeCab 환경설정 삽질 기록 (Ubuntu 24.04 / WSL)

Style-BERT-VITS2로 일본어 음성 합성에 전념하고 있긴 하지만,
내 궁극적인 목표는 일본어, 한국어, 영어 음성을 전부 다루는 것이다.

Style-BERT-VITS2는 현재 한국어를 지원하지 않기에,
똑같이 BERT-VITS 계열인 MeloTTS를 사용해 보았다.

이 글은 그 과정에서 생긴 MeCab 환경설정 문제를 기록한 것이다.

> 목표:  
> 한국어 TTS 전처리(형태소 분석)를 위해 **MeCab + mecab-ko-dic + Python 연동** 환경을 구축한다.  
> 특히 **konlpy.tag.Mecab** 이 정상 동작하는 상태를 만드는 것이 최종 목표다.

## 0. 배경과 전제

- OS: **Ubuntu 24.04 (noble)**, WSL 환경
- Python: 3.10 (venv / uv 사용)
- 목적:
  - TTS 데이터 전처리 (문장 -> 형태소)
  - BERT-VITS 계열 전처리 파이프라인
- 문제의 핵심:
  - 블로그 / 문서 대부분이 **Ubuntu 18.04 / 20.04 기준**
  - Ubuntu 24.04에서 **autotools / MeCab 관련 패키지 구조가 달라짐**

## 1. 흔히 겪는 증상

### 1.1 konlpy + Mecab 사용 시 에러

```python
from konlpy.tag import Mecab
m = Mecab()
```

에러:

```pgsql
NameError: name 'Tagger' is not defined
Exception: Install MeCab in order to use it
```
MeCab core / dic / python binding 중 하나라도 깨져 있으면 발생

## 2. 잘못된 접근들 (삽질 요약)
### 2.1 apt로 mecab-ko 설치 시도
```bash
sudo apt install mecab-ko mecab-ko-dic
```

결과:

```vbnet
E: Unable to locate package mecab-ko
```

Ubuntu 24.04 기본 저장소에는 한국어 MeCab 패키지가 없음

### 2.2 GitHub / open-korean-text repo 사용
```bash
git clone https://github.com/open-korean-text/mecab-ko-dic.git
```

결과:

```nginx
Repository not found
```

공식 소스 아님 / 폐기된 경로

### 2.3 mecab-ko-dic git clone 후 build.sh 실행

증상 요약:

- /usr/local/libexec/mecab/* 바이너리 없음
- matrix.def, left-id.def, right-id.def 누락
- dicrc 없음
- configure / make 연쇄 실패

git repo 방식은 “사전 생성용”이며, 일반 사용자에게 부적합

## 3. 정답 루트

- mecab-ko (core)
- mecab-ko-dic (사전)
- mecab-python (python binding)

tar.gz 배포판을 그대로 사용하는 방식

## 4. mecab-ko (core) 설치
### 4.1 다운로드
```bash
wget https://bitbucket.org/eunjeon/mecab-ko/downloads/mecab-0.996-ko-0.9.2.tar.gz
tar xvfz mecab-0.996-ko-0.9.2.tar.gz
cd mecab-0.996-ko-0.9.2
```

### 4.2 빌드 & 설치
```bash
./configure
make
make check
sudo make install
```

설치 확인:

```bash
which mecab
mecab-config --version
```

## 5. mecab-ko-dic 설치 (여기서 대부분 터진다)
### 5.1 다운로드
```bash
wget https://bitbucket.org/eunjeon/mecab-ko-dic/downloads/mecab-ko-dic-2.1.1-20180720.tar.gz
tar xvfz mecab-ko-dic-2.1.1-20180720.tar.gz
cd mecab-ko-dic-2.1.1-20180720
```

### 5.2 Ubuntu 24.04에서 반드시 필요한 패키지

```bash
sudo apt update
sudo apt install -y \
  automake \
  autoconf \
  autoconf-archive \
  libtool \
  m4
```

### 5.3 핵심 포인트: aclocal 경로 문제
Ubuntu 24.04에서는 aclocal이 기본 매크로 경로를 못 찾는다.
그래서 AM_INIT_AUTOMAKE 에러가 발생한다.

해결:

```bash
aclocal -I /usr/share/aclocal
```

### 5.4 autoreconf & 빌드
```bash
autoreconf -fi
./configure
make -j
sudo make install
```

### 5.5 설치 확인
```bash
ls /usr/local/lib/mecab/dic/mecab-ko-dic/dicrc
```

존재해야 정상.

## 6. 최종 검증
### 6.1 mecab CLI
```bash
echo "테스트입니다" | mecab
```

정상 출력 예:

```
테스트  NNG
입니다  VCP+EF
EOS
```

### 6.2 konlpy 연동
```bash
python -c "from konlpy.tag import Mecab; print(Mecab().pos('테스트입니다'))"
```

정상 출력 예:

```python
[('테스트', 'NNG'), ('입니다', 'VCP+EF')]
```

## 7. MeloTTS 훈련 시 추가 필요 사항

### 7.1 venv에 pip 복구

```bash
uv run python -m ensurepip --upgrade
```

확인:

```bash
uv run python -m pip --version
```

### 7.2 python-mecab-ko 설치

```bash
uv run python -m pip install python-mecab-ko
```

설치 확인:

```bash
uv run python - << 'EOF'
from mecab import MeCab
m = MeCab()
print(m.pos("테스트입니다"))
EOF
```

이게 출력되면 성공이다

## 8. MeloTTS + g2pkk 기준 “정리된 요구사항”

MeloTTS 한국어 전처리에서 필요한 것만 정리하면 이렇다.

1. 시스템 레벨

- mecab (CLI)
- mecab-ko-dic

2. Python 레벨

- python-mecab-ko
- g2pkk

### 8.1 최종 체크리스트

아래가 전부 True면 에러 사라진다.

```bash
echo "테스트입니다" | mecab

uv run python - << 'EOF'
from mecab import MeCab
print(MeCab().pos("테스트입니다"))
EOF

uv run python - << 'EOF'
from g2pkk import G2p
g2p = G2p()
print(g2p("테스트입니다"))
EOF
```

이 세 개 중 하나라도 안 되면, 그 단계가 원인이다.

## 9. 왜 이렇게 지옥이었나 (정리)

참고한 블로그 글은 틀리지 않았다.
MeCab도 틀리지 않았다.

Ubuntu 24.04 + 오래된 autotools 조합이 문제였다.

핵심 원인:
- aclocal 매크로 경로 변경
- 구버전 configure 스크립트

## 10. 결론
- TTS 전처리를 위한 MeCab 환경은 여전히 유효
- 핵심 해결 포인트는 단 하나:
    - aclocal -I /usr/share/aclocal

이 한 줄을 모르면, 끝없는 삽질이 시작된다.